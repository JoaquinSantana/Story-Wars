<div class="pageContainer">
    <div class="container">    
        <p id="notice"><%= notice %></p>
        
        <%# This should be moved to a model %>
        <% user_votes = 0 %>
        <% @user.stories.each do |story| %>
            <% story.chapters.each do |chapter| %>
                <% user_votes = user_votes + chapter.votes.count %>
            <% end %>
        <% end %>

        <% @user.chapters.each do |chapter| %>
            <% user_votes = user_votes + chapter.votes.count %>
        <% end %>
        
        <div class="userProfile">
            <% if current_user == @user %>  
                <div class="col-sm-4 col-xs-12 pull-right">
                    <div class="userButtons pull-right">
                        <%= link_to 'Edit profile', edit_user_path(@user), class: "btn btn-inverse" %>
                        <%= link_to "Logout", logout_path, method: "delete", class: "btn marginLeft" %>
                    </div>
                </div>
            <% end %>
            <div class="col-sm-8 col-xs-12">
                <%= gravatar_for @user %>
                <h1 class="userHeadline">
                    <%= @user.name %> (<%= user_votes %> p)
                    <span class="userEmail"><%= @user.email %></span>
                </h1>
            </div>
        </div>

        <!-- 
        <% if @user.stories.any? %>
            <h3>Stories (<%= @user.stories.count %>)</h3>
            <ol>
                <%= render @user.stories %>
            </ol>
        <% end %> -->
            
        <ul class="primaryList">
            <% @user.stories.each do |story| %>
                <% votes = 0 %>
                <% story.chapters.each do |chapter| %>
                    <% votes = votes + chapter.votes.count %>
                <% end %>
                <li>
                    <%= link_to(story, class: "primaryHeadline") do %>
                        <span><%= story.title %></span>
                        <div class="extraInfo">
                            <span><%= votes %> p</span>
                        </div>
                    <% end %>
                </li>
            <% end %>
        </ul>
        <div class="pull-left col-xs-12 marginTop">
            <h2>Chapters</h2>
            <ul>
                <% @user.chapters.each do |chapter| %>
                    <li class="voteChapter-container">
                        <article class="voteChapter-content" data-readmore="Read more"><%= simple_format(chapter.body) %>
                            <%= link_to "Show story", story_path(chapter.story), :class => "secondaryLink" %>
                            <span class="pull-right"><%= chapter.votes.count %> p</span>
                        </article>
                    </li>
                <% end %>
            </ul>
        </div>
        
        <div class="pull-left col-xs-12 marginTop">
            <h2>Friends</h2>
            <ul class="simpleList">
                <% @user.friends.each do |user| %>
                    <li>
                        <%= user.name %>
                        (<%= link_to "remove", friendship_path(current_user.friendships.find_by_friend_id(user)), :method => :delete %>)
                    </li>
                <% end %>
            </ul>
        </div>

    </div>
</div>